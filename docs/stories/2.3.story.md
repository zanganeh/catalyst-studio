# Story 2.3: Remove Feature Flags from Components and Pages

## Status
Approved

## Story
**As a** developer,
**I want** to remove all feature flag conditionals from React components and Next.js pages,
**so that** all features from Epic 1 are permanently enabled in the UI layer.

## Acceptance Criteria
1. Remove all feature flag imports from components
2. Convert all conditional renders based on flags to permanent implementations
3. Remove feature flag props from component interfaces
4. Update component documentation to remove flag references
5. Simplify component logic that was complicated by feature flags
6. Ensure source code view and all Epic 1 features are unconditionally available

## Tasks / Subtasks

### Task 1: Remove Feature Flag Imports and Usage from Navigation Components (AC: 1, 2, 3)
- [ ] Update `/components/navigation/navigation-sidebar.tsx`
  - [ ] Remove import of feature flag utilities
  - [ ] Remove conditional sidebar item rendering
  - [ ] Permanently show all navigation items
- [ ] Update `/components/navigation/navigation-item.tsx`
  - [ ] Remove feature flag checks for items
  - [ ] Simplify component logic
- [ ] Update `/components/navigation/navigation-section.tsx`
  - [ ] Remove section visibility conditionals
  - [ ] Always render all sections
- [ ] Update `/components/navigation/mobile-navigation.tsx`
  - [ ] Remove mobile menu conditional items
  - [ ] Ensure feature parity with desktop navigation
- [ ] Update `/lib/navigation/types.ts`
  - [ ] Remove `featureFlag` property from navigation type definitions
  - [ ] Update any dependent types

### Task 2: Remove Feature Flags from Chat Components (AC: 1, 2, 5)
- [ ] Update `/components/chat/enhanced-chat-panel.tsx`
  - [ ] Remove feature flag imports
  - [ ] Permanently enable all enhanced chat features
  - [ ] Simplify conditional rendering logic
- [ ] Update `/components/chat/feature-flagged-chat-persistence.tsx`
  - [ ] Remove feature flag checks
  - [ ] Rename component to `chat-persistence.tsx` (remove "feature-flagged" prefix)
  - [ ] Always enable persistence functionality
  - [ ] Update all imports referencing the old filename
- [ ] Update `/app/chat/page.tsx`
  - [ ] Remove feature flag checks
  - [ ] Permanently render all chat features
  - [ ] Clean up any conditional imports

### Task 3: Remove Feature Flags from Content and Preview Components (AC: 1, 2, 6)
- [ ] Update `/app/content-builder/page.tsx`
  - [ ] Remove feature flag checks
  - [ ] Ensure content builder is always accessible
  - [ ] Remove any fallback UI for disabled state
- [ ] Update `/lib/context/preview-context.tsx`
  - [ ] Remove feature flag imports and checks
  - [ ] Preview system always available
  - [ ] Simplify context initialization
- [ ] Update `/app/test-enhanced-chat/page.tsx`
  - [ ] Remove test-specific feature flag manipulation
  - [ ] Evaluate if test page is still needed (keep if it tests enhanced chat features, remove if only for flag testing)

### Task 4: Remove Feature Flags from UI Enhancement Components (AC: 1, 2)
- [ ] Update `/components/glass-morphism.tsx`
  - [ ] Remove feature flag checks
  - [ ] Always apply glass morphism effects when component is used
  - [ ] Simplify conditional styling logic

### Task 5: Update Stub File for Gradual Migration (AC: 2, IV1)
**Note:** This task depends on Story 2.2 being completed first (stub file must exist)
- [ ] Update `/config/features-stub.ts` imports in modified components
  - [ ] Replace actual feature flag imports with stub where needed temporarily
  - [ ] This maintains build stability during transition
- [ ] Remove unnecessary imports entirely where components no longer need them

### Task 6: Verify Component Functionality (AC: 6, IV1, IV2, IV3)
- [ ] Manually test each modified component area:
  - [ ] Navigation sidebar shows all items
  - [ ] Chat features all work (enhanced panel, persistence)
  - [ ] Content builder is accessible
  - [ ] Preview system functions correctly
  - [ ] Source code view is available
  - [ ] Glass morphism effects apply
- [ ] Run development server and check for console errors
- [ ] Verify no TypeScript errors after changes
- [ ] Check that removed conditionals haven't broken any layouts

### Task 7: Clean Up and Optimize (AC: 5)
- [ ] Remove any unused imports that were only for feature flags
- [ ] Simplify component logic where feature flags added complexity
- [ ] Remove any CSS classes that were conditionally applied
- [ ] Delete any component state that tracked feature flags
- [ ] Remove any useEffect hooks that watched for feature flag changes

## Dev Notes

### Previous Story Insights
[Source: Story 2.2 Dev Notes]
- Story 2.2 is removing the core infrastructure (`/config/features.ts`, `/contexts/feature-flag-context.tsx`, `/hooks/use-features.ts`)
- A temporary stub file `/config/features-stub.ts` was created that always returns `true`
- This allows gradual removal without breaking the build
- Type error exists in `contexts/feature-flag-context.tsx` line 50 (will be resolved by removal)

### Architecture Context
[Source: architecture.md#Component Cleanup Strategy]

The following components need modification to remove feature flag logic:
- **Navigation Components** (5 files) - Remove conditional rendering for navigation items
- **Chat Components** (3 files) - Permanently enable enhanced chat and persistence
- **Content/Preview Components** (3 files) - Always show content builder and preview
- **UI Enhancement Components** (1 file) - Always apply visual enhancements

All feature flag checks should be converted to permanent implementations. The goal is direct rendering without any conditional logic based on flags.

### Component Files to Modify
[Source: docs/feature-flag-audit.md#Component Files Using Feature Flags]

**Navigation Components:**
- `/components/navigation/navigation-sidebar.tsx` - Conditional sidebar items
- `/components/navigation/navigation-item.tsx` - Feature flag checks for items
- `/components/navigation/navigation-section.tsx` - Section visibility
- `/components/navigation/mobile-navigation.tsx` - Mobile menu items
- `/lib/navigation/types.ts` - Navigation type definitions with featureFlag property

**Chat Components:**
- `/components/chat/enhanced-chat-panel.tsx` - Enhanced chat features
- `/components/chat/feature-flagged-chat-persistence.tsx` - Persistence logic
- `/app/chat/page.tsx` - Chat page with feature checks

**Content/Preview Components:**
- `/app/content-builder/page.tsx` - Content builder page
- `/lib/context/preview-context.tsx` - Preview system context
- `/app/test-enhanced-chat/page.tsx` - Test page for enhanced chat

**UI Enhancement Components:**
- `/components/glass-morphism.tsx` - Glass morphism effects

### Feature Flag System Being Removed
[Source: docs/feature-flag-audit.md#Executive Summary]

The feature flag system being removed is entirely **client-side** using localStorage:
- No server-side involvement
- No database changes needed
- Components currently import from `/config/features.ts` or use hooks from `/hooks/use-features.ts`
- After Story 2.2, these will be replaced with stub that always returns `true`

### Testing
[Source: architecture.md#Tech Stack Alignment]

**Testing Framework:** Jest/React Testing Library for unit tests, Playwright for E2E tests

**Test Locations:**
- Unit tests: `__tests__/` directories or `*.test.tsx` files
- E2E tests: `/tests/` directory

**Testing Standards for this Story:**
- Manual testing to verify all features are visible and functional
- Check browser console for any runtime errors
- Ensure no layout breaks from removed conditionals
- Verify TypeScript compilation succeeds (`npm run typecheck`)
- Run lint to check for code quality issues (`npm run lint`)
- No new tests required (existing tests will be updated in Story 2.5)

## Integration Verification
- **IV1**: All Epic 1 features (including source code view) are visible and functional
- **IV2**: No UI regressions or layout issues after removal
- **IV3**: Component render performance is maintained or improved

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-11 | 1.0 | Initial story creation based on Epic 2 requirements | Bob (SM) |
| 2025-08-11 | 1.1 | Applied PO feedback: added testing section, clarified renaming, noted Story 2.2 dependency | Bob (SM) |
| 2025-08-11 | 1.2 | Story approved for implementation | Sarah (PO) |