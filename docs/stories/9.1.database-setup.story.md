# Story 9.1: Database Setup and Folder Support

## Status
Approved

## Story
**As a** developer,
**I want** to add the 'folder' enum value to the ContentTypeCategory enum in the database,
**so that** the sitemap builder can create organizational folder nodes that structure the site hierarchy.

## Acceptance Criteria
1. The ContentTypeCategory enum in the database includes 'folder' as a valid value
2. Database migration is created and tested successfully
3. Existing data is not affected by the migration
4. The migration can be rolled back if needed
5. Prisma client is regenerated with the new enum value
6. No breaking changes to existing API endpoints or services

## Tasks / Subtasks
- [ ] Git Setup (REQUIRED FIRST TASK)
  - [ ] Checkout and update main: `git checkout main && git pull premium main`
  - [ ] Verify/create epic branch: `git checkout -b epic/epic-9-sitemap-builder || git checkout epic/epic-9-sitemap-builder`
  - [ ] Create story branch from epic: `git checkout -b story/EPIC9-001-database-setup`
- [ ] Update Prisma Schema (AC: 1, 5)
  - [ ] Open prisma/schema.prisma file
  - [ ] Add 'folder' to ContentTypeCategory enum after 'component'
  - [ ] Verify schema syntax is correct
- [ ] Create Database Migration (AC: 2, 3)
  - [ ] Run `npx prisma migrate dev --name add-folder-category`
  - [ ] Review generated migration SQL to ensure it only adds the enum value
  - [ ] Verify migration file is created in prisma/migrations folder
- [ ] Test Migration (AC: 2, 3, 4)
  - [ ] Apply migration to development database
  - [ ] Verify 'folder' value exists in ContentTypeCategory enum
    - Optional SQL check: `SELECT 'folder' IN (SELECT unnest(enum_range(NULL::"ContentTypeCategory")));`
  - [ ] Test that existing data remains intact
  - [ ] Create a test folder entry to verify enum works
  - [ ] Test rollback by resetting database: `npx prisma migrate reset`
  - [ ] Re-apply migration to confirm it works consistently
- [ ] Regenerate Prisma Client (AC: 5)
  - [ ] Run `npx prisma generate`
  - [ ] Verify TypeScript types include 'folder' in ContentTypeCategory
  - [ ] Check that autocomplete shows 'folder' as an option
- [ ] Verify No Breaking Changes (AC: 6)
  - [ ] Test existing endpoints that use ContentTypeCategory
  - [ ] Ensure ContentTypeService still works with existing values
  - [ ] Verify SiteStructureService handles existing page/component types
- [ ] Submit PR (REQUIRED FINAL TASK)
  - [ ] Push branch: `git push -u premium story/EPIC9-001-database-setup`
  - [ ] Create PR from feature branch â†’ epic/epic-9-sitemap-builder branch
  - [ ] PR Title: "feat(EPIC9-001): add folder enum to ContentTypeCategory"
  - [ ] Link PR to story in description
  - [ ] Include migration testing results in PR description

## Dev Notes

### GitFlow Workflow
**CRITICAL: Follow GitFlow strictly for this story**

Branch Name: story/EPIC9-001-database-setup
Base Branch: epic/epic-9-sitemap-builder (create from main if doesn't exist)
PR Target: epic/epic-9-sitemap-builder

Git Commands:
1. Setup: `git checkout main && git pull premium main`
2. Create epic branch if needed: `git checkout -b epic/epic-9-sitemap-builder`
3. Create story branch from epic: `git checkout -b story/EPIC9-001-database-setup`
4. Commit: Use conventional commits (feat:, fix:, docs:, etc.)
5. Push: `git push -u premium story/EPIC9-001-database-setup`
6. PR: Create PR to epic/epic-9-sitemap-builder branch with title "feat(EPIC9-001): add folder enum to ContentTypeCategory"

### Database Migration Details
[Source: epic9-brownfield-architecture.md#database-migration-required]

**Through Prisma Migration**:
1. Update schema.prisma to add 'folder' to ContentTypeCategory enum
2. Run: `npx prisma migrate dev --name add-folder-category`
3. Prisma will generate the SQL and handle the migration

**Important**: This is the ONLY database change required for the entire Epic 9. The enum addition enables folder support without modifying any existing tables. Folder metadata will be stored in the existing ContentItem.metadata JSON field.

### Schema Location and Current Enum Values
The ContentTypeCategory enum is defined in `prisma/schema.prisma`. Current values are:
- page
- component

After this story, it will include:
- page
- component
- folder

### Testing Standards
[Source: No specific testing standards found in current architecture docs]

**Testing Requirements**:
- Migration must be tested on a clean database
- Migration must be tested on a database with existing data
- Rollback capability must be verified
- No automated tests required for this story (database migration only)
- Manual testing checklist must be completed and documented

### Previous Story Insights
This is the first story in Epic 9, so no previous story context exists.

### Integration Points
The 'folder' enum will be used by:
- SiteStructureService (will be extended in later stories to handle folders)
- ContentItemService (folders will use metadata field for configuration)
- Sitemap UI components (will create nodes with type='folder')

### Risks and Considerations
- PostgreSQL doesn't support IF NOT EXISTS for enum values, so the migration assumes 'folder' doesn't exist
- If migration fails, it could be because 'folder' was already added manually
- The migration is irreversible in production (enum values cannot be removed in PostgreSQL)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-25 | 1.0 | Initial story creation | Scrum Master |
| 2025-08-25 | 1.1 | Applied PO feedback: fixed branch naming, added SQL check, approved | Scrum Master |
| 2025-08-25 | 1.2 | Fixed branch naming consistency, added epic branch verification, clarified file paths | Scrum Master |

## Dev Agent Record

### Agent Model Used
[To be filled by Dev Agent]

### Debug Log References
[To be filled by Dev Agent]

### Completion Notes List
[To be filled by Dev Agent]

### File List
[To be filled by Dev Agent]

## QA Results
[To be filled by QA Agent]