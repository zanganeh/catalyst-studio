generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Website {
  id           String        @id @default(cuid())
  name         String
  description  String?
  category     String
  metadata     String?
  icon         String?
  settings     String?
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  contentItems ContentItem[]
  contentTypes ContentType[]
  aiContexts   AIContext[]
}

model ContentType {
  id           String        @id @default(cuid())
  websiteId    String
  name         String
  fields       String
  settings     String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  contentItems ContentItem[]
  website      Website       @relation(fields: [websiteId], references: [id], onDelete: Cascade)
}

model ContentItem {
  id            String      @id @default(cuid())
  contentTypeId String
  websiteId     String
  data          String
  status        String      @default("draft")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  metadata      String?
  publishedAt   DateTime?
  slug          String?
  website       Website     @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  contentType   ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Cascade)

  @@index([websiteId, contentTypeId])
  @@index([slug])
  @@index([status, publishedAt])
}

model AIContext {
  id           String   @id @default(cuid())
  websiteId    String
  sessionId    String
  messages     String   // JSON array of conversation messages
  metadata     String?  // JSON context metadata (tokens, model, etc.)
  summary      String?  // Summarized context for long conversations
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  website Website @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  
  @@index([websiteId, sessionId])
  @@unique([websiteId, sessionId])
}
